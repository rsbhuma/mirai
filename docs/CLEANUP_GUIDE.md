# 🧹 Community Coin - Docker Cleanup Guide

This guide explains how to properly stop and clean up Docker containers when working with the Community Coin E2E environment.

## 🚀 Quick Solutions

### Option 1: Use Ctrl+C (Recommended)
When running `./setup-localnet-e2e.sh`, simply press **Ctrl+C** to automatically stop all services and cleanup containers.

```bash
# The script will automatically run cleanup when interrupted
./setup-localnet-e2e.sh
# Press Ctrl+C when you want to stop
```

### Option 2: Manual Cleanup Script
Run the comprehensive cleanup script:

```bash
./cleanup-e2e.sh
```

### Option 3: Quick Cleanup
For immediate cleanup of running containers:

```bash
./quick-cleanup.sh
```

## 📋 Available Scripts

| Script | Purpose | When to Use |
|--------|---------|-------------|
| `cleanup-e2e.sh` | Comprehensive cleanup of all containers, networks, and orphaned resources | When you want complete cleanup |
| `quick-cleanup.sh` | Fast cleanup of running containers only | When you just need to stop containers quickly |
| `stop-localnet-e2e.sh` | Legacy stop script (generated by setup) | Alternative method |

## 🔍 Manual Commands

### Check Running Containers
```bash
docker ps
```

### Stop Specific Containers
```bash
# Stop individual containers
docker stop solana-validator
docker stop solana-dev
docker stop community_coin_server
docker stop community_coin_postgres
docker stop community_coin_redis

# Stop all Community Coin containers
docker stop $(docker ps -q --filter name=community_coin)
docker stop $(docker ps -q --filter name=solana)
```

### Clean Up Resources
```bash
# Remove stopped containers
docker container prune -f

# Remove unused networks
docker network prune -f

# Remove unused volumes (⚠️ This will delete data!)
docker volume prune -f

# Remove unused images
docker image prune -a
```

## 🛠️ Troubleshooting

### Containers Won't Stop
If containers are stuck, force kill them:
```bash
docker kill $(docker ps -q)
```

### Clean Everything (Nuclear Option)
⚠️ **Warning**: This will remove ALL Docker containers, networks, and volumes!
```bash
docker system prune -a --volumes
```

### Check What's Using Ports
If you get "port already in use" errors:
```bash
# Check what's using specific ports
sudo lsof -i :8080  # Rust server
sudo lsof -i :8899  # Solana RPC
sudo lsof -i :5173  # Frontend
sudo lsof -i :5433  # PostgreSQL
sudo lsof -i :6380  # Redis
```

## 📊 Container Overview

The E2E environment runs these containers:

| Container | Port | Purpose |
|-----------|------|---------|
| `solana-validator` | 8899, 8900 | Solana test validator |
| `solana-dev` | - | Solana development environment |
| `community_coin_server` | 8080 | Rust backend server |
| `community_coin_postgres` | 5433 | PostgreSQL database |
| `community_coin_redis` | 6380 | Redis cache |

## 🎯 Best Practices

1. **Always cleanup**: Use cleanup scripts to avoid port conflicts
2. **Check status**: Run `docker ps` to verify containers are stopped
3. **Use Ctrl+C**: The setup script handles cleanup automatically
4. **Preserve data**: The cleanup scripts preserve Docker volumes by default
5. **Monitor resources**: Use `docker system df` to check disk usage

## 🚨 Emergency Cleanup

If everything is broken and you need to start fresh:

```bash
# Stop everything
docker stop $(docker ps -aq)

# Remove everything
docker system prune -a --volumes

# Restart Docker service (if needed)
sudo systemctl restart docker
```

## 💡 Tips

- The `setup-localnet-e2e.sh` script now includes automatic cleanup on exit
- Use `./cleanup-e2e.sh` for the most thorough cleanup
- The scripts are designed to be safe and won't delete important data
- You can run cleanup scripts multiple times safely 